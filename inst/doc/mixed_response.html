<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Models with Mixed Response Types</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Models with Mixed Response Types</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(galamm)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code></pre></div>
<p>This vignette describes how <code>galamm</code> can be used to
estimate models with mixed response types.</p>
<div id="mixed-normal-and-binomial-response" class="section level2">
<h2>Mixed Normal and Binomial Response</h2>
<p>We start with the <code>mresp</code> dataset, which comes with the
package. The variable “itemgroup” defines the response type; it equals
“a” for normally distributed responses and “b” for binomially
distributed responses. They are link through a common random
intercept.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">head</span>(mresp)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt;   id         x          y itemgroup</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; 1  1 0.8638214  0.2866329         a</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; 2  1 0.7676133  2.5647490         a</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; 3  1 0.8812059  1.0000000         b</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; 4  1 0.2239725  1.0000000         b</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; 5  2 0.7215696 -0.4721698         a</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; 6  2 0.6924851  1.1750286         a</span></span></code></pre></div>
<p>In terms of the GALAMM defined in the <a href="https://lcbc-uio.github.io/galamm/articles/galamm.html">introductory
vignette</a>, and for simplicity assuming we use canonical link
functions, we have the response model</p>
<p><span class="math display">\[
f\left(y_{ij} | \nu_{ij}, \phi\right) = \exp \left( \frac{y_{ij}\nu_{ij}
- b\left(\nu_{ij}\right)}{\phi} + c\left(y_{ij}, \phi\right) \right)
\]</span></p>
<p>for the <span class="math inline">\(i\)</span>th observation of the
<span class="math inline">\(j\)</span> subject. Although we don’t show
this with a subscript, when the variable <code>itemgroup = &quot;a&quot;</code> we
have a Gaussian response, so <span class="math inline">\(b(\nu) =
\nu^{2}/2\)</span> and the support of the distribution is the entire
real line <span class="math inline">\(\mathbb{R}\)</span>. The mean in
this case is given by <span class="math inline">\(\mu_{ij} =
\nu_{ij}\)</span>. When <code>itemgroup = &quot;b&quot;</code> we have a binomial
response, so <span class="math inline">\(b(\nu) = \log(1 +
\exp(\nu))\)</span> and the support is <span class="math inline">\(\{0,
1\}\)</span>. In this binomial case we also have <span class="math inline">\(\phi=1\)</span>. The mean in this case is given by
<span class="math inline">\(\mu_{ij} = \exp(\nu_{ij}) / (1 +
\exp(\nu_{ij}))\)</span>. The function <span class="math inline">\(c(y_{ij}, \phi)\)</span> also differs between
these cases, but is not of the same interest, since it does not depend
on the linear predictor. It hence matters for the value of the
log-likelihood, but not for its derivative with respect to the
parameters of interest.</p>
<p>Next, the nonlinear predictor is given by</p>
<p><span class="math display">\[\nu_{ij} = \beta_{0} + x_{ij}\beta_{1} +
\mathbf{z}_{ij}^{T}\boldsymbol{\lambda} \eta\]</span></p>
<p>where <span class="math inline">\(x_{ij}\)</span> is an explanatory
and <span class="math inline">\(\mathbf{z}_{ij}\)</span> is a dummy
vector of length 2 with exactly one element equal to one and one element
equal to zero. When <code>itemgroup = &quot;a&quot;</code>, <span class="math inline">\(\mathbf{z} = (1, 0)^{T}\)</span> and when
<code>itemgroup = &quot;b&quot;</code>, <span class="math inline">\(\mathbf{z} =
(0, 1)^{T}\)</span>. The parameter <span class="math inline">\(\boldsymbol{\lambda} = (1, \lambda)^{T}\)</span>
is a vector of factor loadings, whose first element equals zero for
identifiability. <span class="math inline">\(\eta\)</span> is a latent
variable, in this case representing an underlying trait “causing” the
observed responses.</p>
<p>The structural model is simply</p>
<p><span class="math display">\[
\eta = \zeta \sim N(0, \psi),
\]</span></p>
<p>where <span class="math inline">\(N(0, \psi)\)</span> denotes a
normal distribution with mean 0 and variance <span class="math inline">\(\psi\)</span>.</p>
<p>We define the loading matrix as follows, where the value
<code>1</code> indicates that the first element <span class="math inline">\(\boldsymbol{\lambda}\)</span> is fixed, and the
value <code>NA</code> indicates that its second element is unknown, and
to be estimated.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>(loading_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>), <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; [2,]   NA</span></span></code></pre></div>
<p>We set <code>load.var = &quot;itemgroup&quot;</code> because all rows of the
data with the same value of <code>itemgroup</code> will receive the same
factor loading. In <code>formula</code>, we state
<code>(0 + level | id)</code> to specify that each subject, identified
by <code>id</code>, has a given level. <code>level</code> is not an
element of the <code>mresp</code> data, but is instead the factor onto
which the loading matrix loads. We identify this with the argument
<code>factor = list(&quot;level&quot;)</code>. We could have chosen any other name
for <code>&quot;level&quot;</code>, except for names that are already columns in
<code>mresp</code>.</p>
<p>We also need to define the response families, with the vector</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>families <span class="ot">&lt;-</span> <span class="fu">c</span>(gaussian, binomial)</span></code></pre></div>
<p>We also need a way of telling galamm which row belongs to which
family, which we do with a family mapping. The values in
<code>family_mapping</code> refer to the elements of
<code>families</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>family_mapping <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mresp<span class="sc">$</span>itemgroup <span class="sc">==</span> <span class="st">&quot;a&quot;</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span></code></pre></div>
<p>We are now ready to estimate the mixed response model.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>mixed_resp <span class="ot">&lt;-</span> <span class="fu">galamm</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> level <span class="sc">|</span> id),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">data =</span> mresp,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">family =</span> families,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="at">family_mapping =</span> family_mapping,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="at">load.var =</span> <span class="st">&quot;itemgroup&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">list</span>(loading_matrix),</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="at">factor =</span> <span class="fu">list</span>(<span class="st">&quot;level&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>)</span></code></pre></div>
<p>We can also look at its summary output.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">summary</span>(mixed_resp)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; Formula: y ~ x + (0 + level | id)</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;    Data: mresp</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt;   9248.7   9280.2  -4619.3   3633.1     3995 </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; Scaled residuals: </span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; -3.5360 -0.7078  0.2156  0.6456  2.5978 </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; Lambda:</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;         level      SE</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; lambda1 1.000       .</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; lambda2 1.095 0.09982</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt;  Groups Name  Variance Std.Dev.</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt;  id     level 1.05     1.025   </span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; Number of obs: 4000, groups:  id, 1000</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error z value  Pr(&gt;|z|)</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; (Intercept)    0.041    0.05803  0.7065 4.799e-01</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt; x              0.971    0.08594 11.2994 1.321e-29</span></span></code></pre></div>
<div id="mixed-response-and-heteroscedastic-residuals" class="section level3">
<h3>Mixed Response and Heteroscedastic Residuals</h3>
<p>Mixed response models can be combined with heteroscedastic residuals,
which are described in the vignette on <a href="https://lcbc-uio.github.io/galamm/articles/lmm_heteroscedastic.html">linear
mixed models with heteroscedastic residuals</a>. However, some care is
needed in this case. We illustrate with the dataset
<code>mresp_hsced</code>, whose first few lines are shown below:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">head</span>(mresp_hsced)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt;   id         x           y itemgroup grp isgauss</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; 1  1 0.8638214   0.2866329         a   b       1</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; 2  1 0.7676133   2.5647490         a   b       1</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; 3  1 0.8812059   1.0000000         b   b       0</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; 4  1 0.2239725   1.0000000         b   b       0</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; 5  2 0.7215696 -11.0020148         a   a       1</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 6  2 0.6924851   1.1750286         a   b       1</span></span></code></pre></div>
<p>This dataset has the same structure as <code>mresp</code>, except
that the residual standard deviation of the normally distributed
responses vary according to the variable <code>grp</code>, which has two
levels. Two fit a model on this dataset with heteroscedastic residuals
for the normally distributed variable, we must use the dummy variable
<code>isgauss</code> when setting up the <code>weights</code>. This is
illustrated below. By writing <code>~ (0 + isgauss | grp)</code> we
specify that the heteroscedasticity is assumed between levels of
<code>grp</code>, but that this only applies when <code>isgauss</code>
is nonzero. Hence, the binomially distributed responses don’t have any
heteroscedastic residuals estimated, since for these observations the
dispersion parameter <span class="math inline">\(\phi\)</span> is fixed
to 1. We also ignore the factor loadings for simplicity.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>family_mapping <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mresp<span class="sc">$</span>itemgroup <span class="sc">==</span> <span class="st">&quot;a&quot;</span>, 1L, 2L)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">galamm</span>(</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span> (<span class="dv">0</span> <span class="sc">+</span> isgauss <span class="sc">|</span> grp),</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">c</span>(gaussian, binomial),</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="at">family_mapping =</span> family_mapping,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="at">data =</span> mresp_hsced</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>)</span></code></pre></div>
<p>The summary output now shows that we also have estimated a variance
function.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">summary</span>(mod)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; Formula: y ~ x + (1 | id)</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt;    Data: mresp_hsced</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; Weights: ~(0 + isgauss | grp)</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt;  12356.9  12388.3  -6173.4  31426.4     3995 </span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; Scaled residuals: </span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; -15.2275  -0.4025   0.1262   0.6757  16.0284 </span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt;  Groups Name        Variance Std.Dev.</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;  id     (Intercept) 0        0       </span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; Number of obs: 4000, groups:  id, 1000</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; Variance function:</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt;       a       b </span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt; 1.00000 0.07756 </span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error z value  Pr(&gt;|z|)</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">#&gt; (Intercept)  0.01523    0.06303  0.2416 8.091e-01</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">#&gt; x            0.99563    0.11153  8.9267 4.388e-19</span></span></code></pre></div>
</div>
</div>
<div id="covariate-measurement-error-model" class="section level2">
<h2>Covariate Measurement Error Model</h2>
<p>This example is taken from Chapter 14.2 in <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>, and
follows the analyses in <span class="citation">(<a href="#ref-rabe-heskethCorrectingCovariateMeasurement2003">Rabe-Hesketh,
Pickles, and Skrondal 2003</a>; <a href="#ref-rabe-heskethMaximumLikelihoodEstimation2003">Rabe-Hesketh,
Skrondal, and Pickles 2003</a>)</span>. No originality is claimed with
respect to the analyses; but for the sake of understanding the
<code>galamm</code> code, we explain it in quite some detail. The
original dataset comes from <span class="citation">Morris, Marr, and
Clayton (<a href="#ref-morrisDietHeartPostscript1977">1977</a>)</span>.</p>
<p>The scientific question concerns the impact of fiber intake on risk
of coronary heat disease. 337 middle aged men were followed, all of whom
either worked as bank staff or as London Transport staff (indicated by
dummy variable <code>bus</code>). All men had a first measurement of
fiber intake, and some had an additional measurement six months later.
In addition, all had a binary variable indicating whether or not they
had developed coronary heart disease.</p>
<p>The first few rows of the dataset are printed below. All of these had
only a single measurement of fiber intake.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">head</span>(diet)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt;   id   age bus   item         y chd fiber fiber2</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; 1  1 -0.38   1 fiber1 17.814280   0     1      0</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; 2  1 -0.38   1    chd  0.000000   1     0      0</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; 3  2  0.54   1 fiber1  9.487736   0     1      0</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; 4  2  0.54   1    chd  0.000000   1     0      0</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; 5  3  8.78   1 fiber1 15.958630   0     1      0</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; 6  3  8.78   1    chd  0.000000   1     0      0</span></span></code></pre></div>
<p>It is instructive to also look at some men who had two measurements
of fiber intake. Here are three of them.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>diet[diet<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">219</span>, <span class="dv">220</span>, <span class="dv">221</span>), ]</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt;      id   age bus   item        y chd fiber fiber2</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; 429 219 -8.13   0 fiber1 15.64263   0     1      0</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; 430 219 -8.13   0 fiber2 14.87973   0     1      1</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; 431 219 -8.13   0    chd  0.00000   1     0      0</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; 432 220 -1.13   0 fiber1 13.46374   0     1      0</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; 433 220 -1.13   0 fiber2 14.73168   0     1      1</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; 434 220 -1.13   0    chd  0.00000   1     0      0</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; 435 221  3.67   0 fiber1 15.95863   0     1      0</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; 436 221  3.67   0 fiber2 17.28778   0     1      1</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; 437 221  3.67   0    chd  0.00000   1     0      0</span></span></code></pre></div>
<div id="structural-model" class="section level3">
<h3>Structural Model</h3>
<p>Our first goal is to model the effect of fiber intake on risk of
heart disease. Since this variable is very likely to be subject to
measurement error, it is well known that simply averaging the two
measurements, where available, and using the single measurement
otherwise, will lead to bias and lack of power <span class="citation">(<a href="#ref-carrollMeasurementErrorNonlinear2006">Carroll et al.
2006</a>)</span>. Instead, we let <span class="math inline">\(\eta_{j}\)</span> denote the true (latent) fiber
intake of person <span class="math inline">\(j\)</span>, and define the
structural model</p>
<p><span class="math display">\[\eta_{j} =
\mathbf{x}_{ij}&#39;\boldsymbol{\gamma} + \zeta_{j}.\]</span></p>
<p>where <span class="math inline">\(\mathbf{x}_{ij}\)</span> is a
vector of covariates age, bus, and their interaction, as well as a
constant term for defining the intercept. The R formula for setting up
the model matrix would be
<code>model.matrix(~ age * bus, data = diet)</code>. The term <span class="math inline">\(\zeta_{j}\)</span> is a normally distributed
disturbance, <span class="math inline">\(\zeta_{j} \sim N(0,
\psi)\)</span>.</p>
</div>
<div id="measurement-model" class="section level3">
<h3>Measurement Model</h3>
<p>It is assumed that the fiber measurements are normally distributed
around the true value <span class="math inline">\(\eta_{j}\)</span>, and
allow for a drift term <span class="math inline">\(d_{ij}\beta_{0}\)</span>, where <span class="math inline">\(d_{2ij}\)</span> is a dummy variable whose value
equals one if the <span class="math inline">\(i\)</span>th row of the
<span class="math inline">\(j\)</span>th person is a replicate fiber
measurement, and zero otherwise. This allows for a drift in the
measurements, and the model becomes</p>
<p><span class="math display">\[y_{ij} = d_{2ij} \beta_{0} + \eta_{j} +
\epsilon_{ij}, \qquad \epsilon_{ij} = N(0, \theta).\]</span></p>
</div>
<div id="disease-model" class="section level3">
<h3>Disease Model</h3>
<p>Next, for the rows corresponding to coronary heart disease
measurement, we assume a binomial model with a logit link function,
i.e., logistic regression. This model is given by</p>
<p><span class="math display">\[\text{logit}[P(y_{ij}=1 | \eta_{j})] =
\mathbf{x}_{ij}&#39;\boldsymbol{\beta} + \lambda \eta_{j},\]</span></p>
<p>where <span class="math inline">\(\mathbf{x}_{ij}\)</span> is the
same as before, but where <span class="math inline">\(\boldsymbol{\beta}\)</span> now represents the
direct effect of age and bus on the probability of coronary heart
disease. The factor loading <span class="math inline">\(\lambda\)</span>
is the regression coefficient for latent fiber intake on the risk of
coronary heart disease.</p>
</div>
<div id="nonlinear-predictor" class="section level3">
<h3>Nonlinear Predictor</h3>
<p>Stacking the three responses, which are fiber intake at times 1 and
2, and coronary heart disease, we can define the joint model as a GLLAMM
with nonlinear predictor</p>
<p><span class="math display">\[\nu_{ij} = d_{2ij} \beta_{0} + d_{3ij}
\mathbf{x}_{j}&#39;\boldsymbol{\beta} +
\mathbf{x}_{j}&#39;\boldsymbol{\gamma}\left[(d_{1i} + d_{2i}) + \lambda
d_{3i}\right] + \zeta_{j} \left[(d_{1i} + d_{2i}) + \lambda
d_{3i}\right],\]</span></p>
<p>where <span class="math inline">\(d_{1i}\)</span> is a dummy variable
for fiber measurements at timepoint 1 and <span class="math inline">\(d_{3i}\)</span> is an indicator for coronary heart
disease.</p>
</div>
<div id="estimating-the-model-with-galamm" class="section level3">
<h3>Estimating the Model with galamm</h3>
<p>In the measurement model for fiber above, note that we implicitly
have factor loadings equal to one. Letting the <code>item</code>
variable define which rows should receive which loading, we note that
the factor levels are as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">levels</span>(diet<span class="sc">$</span>item)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;fiber1&quot; &quot;fiber2&quot; &quot;chd&quot;</span></span></code></pre></div>
<p>We could of course have changed this, but given these levels, we
define the following loading matrix:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>(loading_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>), <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; [2,]    1</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; [3,]   NA</span></span></code></pre></div>
<p>That is, “fiber1” and “fiber2” receive a loading fixed to one,
whereas the loading for “chd” remains to be estimated.</p>
<p>We also need to define the families, making sure it is binomial for
“chd” and Gaussian for “fiber1” and “fiber2”.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>families <span class="ot">&lt;-</span> <span class="fu">c</span>(gaussian, binomial)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>family_mapping <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(diet<span class="sc">$</span>item <span class="sc">==</span> <span class="st">&quot;chd&quot;</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>The model formula also needs some care in this case. We define it as
follows, and note that the whole part
<code>0 + chd + fiber + fiber2</code> could have been replaced by
<code>item</code>. We use the former for ease of explanation.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>formula <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> chd <span class="sc">+</span> (age <span class="sc">*</span> bus)<span class="sc">:</span>chd <span class="sc">+</span> fiber <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  (age <span class="sc">*</span> bus)<span class="sc">:</span>fiber <span class="sc">+</span> fiber2 <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> loading <span class="sc">|</span> id)</span></code></pre></div>
<p>The initial zero specifies that we don’t want R to insert an
intercept term. Next, <code>chd + (age * bus) : chd</code> applies to
“chd” rows only, and corresponds to <span class="math inline">\(\mathbf{x}_{ij}^{T} \boldsymbol{\beta}\)</span> in
the disease model. The part <code>fiber + (age * bus) : fiber</code>
corresponds to the term <span class="math inline">\(\mathbf{x}_{ij}^{T}\boldsymbol{\gamma}\)</span> in
the disease model, and <code>fiber2</code> corresponds to the drift term
<span class="math inline">\(d_{2ij}\beta_{0}\)</span>.</p>
<p>We can inspect the model implied by the formula by using the
<code>nobars</code> function from <a href="https://cran.r-project.org/package=lme4">lme4</a> <span class="citation">(<a href="#ref-batesFittingLinearMixedEffects2015">Bates et al.
2015</a>)</span> to remove the random effects, and then
<code>model.matrix</code>. It looks correctly set up.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">model.matrix</span>(<span class="fu">nobars</span>(formula), <span class="at">data =</span> diet))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt;   chd fiber fiber2 chd:age chd:bus age:fiber bus:fiber chd:age:bus age:bus:fiber</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; 1   0     1      0    0.00       0     -0.38         1        0.00         -0.38</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; 2   1     0      0   -0.38       1      0.00         0       -0.38          0.00</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; 3   0     1      0    0.00       0      0.54         1        0.00          0.54</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; 4   1     0      0    0.54       1      0.00         0        0.54          0.00</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; 5   0     1      0    0.00       0      8.78         1        0.00          8.78</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; 6   1     0      0    8.78       1      0.00         0        8.78          0.00</span></span></code></pre></div>
<p>Finally, the random effects part <code>(0 + loading | id)</code>
specifies that for each <code>id</code> there should be a single random
intercept, which corresponds to latent fiber intake <span class="math inline">\(\eta_{j}\)</span>. Writing
<code>0 + loading</code> means that <span class="math inline">\(\eta_{j}\)</span> should be multiplied by the
factor loadings defined in the loading matrix.</p>
<p>We are now ready to fit the model.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">galamm</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="at">formula =</span> formula,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="at">data =</span> diet,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="at">family =</span> families,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="at">family_mapping =</span> family_mapping,</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="at">factor =</span> <span class="fu">list</span>(<span class="st">&quot;loading&quot;</span>),</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="at">load.var =</span> <span class="st">&quot;item&quot;</span>,</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">list</span>(loading_matrix)</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>)</span></code></pre></div>
<p>Looking at the summary output, however, we see a warning that the
Hessian matrix is rank deficient.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">summary</span>(mod)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; Warning in vcov.galamm(object, parm = &quot;lambda&quot;): Rank deficient Hessian matrix.Could not compute covariance matrix.</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; Warning in vcov.galamm(object, &quot;beta&quot;): Rank deficient Hessian matrix.Could not compute covariance matrix.</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; Formula: formula</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt;    Data: diet</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt;   2837.6   2892.9  -1406.8  12529.3      730 </span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; Scaled residuals: </span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; -10.1375  -0.4389  -0.3522   0.2743  27.3350 </span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt; Lambda:</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt;         loading SE</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; lambda1   1.000  .</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">#&gt; lambda2   1.000  .</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">#&gt; lambda3  -2.026  .</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co">#&gt;  Groups Name    Variance Std.Dev.</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="co">#&gt;  id     loading 0        0       </span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co">#&gt; Number of obs: 742, groups:  id, 333</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a><span class="co">#&gt; chd           -1.78692         NA      NA       NA</span></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="co">#&gt; fiber         17.96184         NA      NA       NA</span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="co">#&gt; fiber2        -0.64927         NA      NA       NA</span></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="co">#&gt; chd:age        0.06682         NA      NA       NA</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="co">#&gt; chd:bus       -0.06882         NA      NA       NA</span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a><span class="co">#&gt; fiber:age     -0.20480         NA      NA       NA</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="co">#&gt; fiber:bus     -1.69601         NA      NA       NA</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="co">#&gt; chd:age:bus   -0.04934         NA      NA       NA</span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a><span class="co">#&gt; fiber:age:bus  0.16097         NA      NA       NA</span></span></code></pre></div>
<p>We suspect that this is a convergence issue of the algorithm, and
start by simply turning a lever to make the algorithm more verbose. The
argument <code>trace = 3</code> is passed onto <code>optim</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">galamm</span>(</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="at">formula =</span> formula,</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="at">data =</span> diet,</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="at">family =</span> families,</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="at">family_mapping =</span> family_mapping,</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="at">factor =</span> <span class="fu">list</span>(<span class="st">&quot;loading&quot;</span>),</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  <span class="at">load.var =</span> <span class="st">&quot;item&quot;</span>,</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">list</span>(loading_matrix),</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">galamm_control</span>(<span class="at">optim_control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="dv">3</span>))</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>)</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt; N = 11, M = 20 machine precision = 2.22045e-16</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt; At X0, 0 variables are exactly at the bounds</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; At iterate     0  f=         2148  |proj g|=       122.68</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt; At iterate    10  f =       1770.3  |proj g|=        30.656</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt; At iterate    20  f =       1467.2  |proj g|=        11.286</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt; At iterate    30  f =       1417.6  |proj g|=        73.904</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co">#&gt; At iterate    40  f =       1406.8  |proj g|=       0.21144</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a><span class="co">#&gt; iterations 43</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co">#&gt; function evaluations 51</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co">#&gt; segments explored during Cauchy searches 44</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="co">#&gt; BFGS updates skipped 0</span></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a><span class="co">#&gt; active bounds at final generalized Cauchy point 1</span></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a><span class="co">#&gt; norm of the final projected gradient 0.0123301</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co">#&gt; final function value 1406.8</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a><span class="co">#&gt; F = 1406.8</span></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a><span class="co">#&gt; final  value 1406.801105 </span></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a><span class="co">#&gt; converged</span></span></code></pre></div>
<p>Now we got some information, but the final estimate is the same,
since we otherwise used the same parameters. We now instead try to
increase the initial estimate of the random effect parameter <span class="math inline">\(\theta\)</span>. In general <span class="math inline">\(\theta\)</span> is a vector containing elements of
the Cholesky factor of the covariance matrix (see, <span class="citation">Bates et al. (<a href="#ref-batesFittingLinearMixedEffects2015">2015</a>)</span>), but in
this case it is just the standard deviation of the latent variable. By
default, its initial value is 1, but we now try to increase it to 10,
with the <code>start</code> argument.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">galamm</span>(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="at">formula =</span> formula,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="at">data =</span> diet,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  <span class="at">family =</span> families,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="at">family_mapping =</span> family_mapping,</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="at">factor =</span> <span class="fu">list</span>(<span class="st">&quot;loading&quot;</span>),</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  <span class="at">load.var =</span> <span class="st">&quot;item&quot;</span>,</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">list</span>(loading_matrix),</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="dv">10</span>),</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">galamm_control</span>(<span class="at">optim_control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="dv">3</span>))</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>)</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt; N = 11, M = 20 machine precision = 2.22045e-16</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt; At X0, 0 variables are exactly at the bounds</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt; At iterate     0  f=       2827.6  |proj g|=       123.31</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="co">#&gt; At iterate    10  f =       1764.5  |proj g|=        103.86</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="co">#&gt; At iterate    20  f =       1623.6  |proj g|=        131.81</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt; At iterate    30  f =       1442.4  |proj g|=        35.169</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt; At iterate    40  f =         1388  |proj g|=        20.654</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt; At iterate    50  f =       1372.4  |proj g|=        1.4042</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a><span class="co">#&gt; iterations 57</span></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a><span class="co">#&gt; function evaluations 69</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a><span class="co">#&gt; segments explored during Cauchy searches 58</span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="co">#&gt; BFGS updates skipped 0</span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a><span class="co">#&gt; active bounds at final generalized Cauchy point 0</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a><span class="co">#&gt; norm of the final projected gradient 0.0119052</span></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a><span class="co">#&gt; final function value 1372.16</span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a><span class="co">#&gt; F = 1372.16</span></span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a><span class="co">#&gt; final  value 1372.160387 </span></span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a><span class="co">#&gt; converged</span></span></code></pre></div>
<p>The output printed is the negative log-likelihood, and since 1372.16
is less than 1406.8, increasing the initial value to 10 led us to a
local optimum with higher likelihood value. Ideally we should have tried
other initial values as well, but since <span class="citation">Skrondal
and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>
obtained a negative log-likelihood value of 1372.35 while using adaptive
quadrature estimation, we are pretty happy about finding a value close
to theirs.</p>
<p>We can now use the summary method, where we find that our estimates
are very close to the corresponding model in Table 14.1 of <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">summary</span>(mod)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt; Formula: formula</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co">#&gt;    Data: diet</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co">#&gt; Control: galamm_control(optim_control = list(trace = 3))</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="co">#&gt;   2768.3   2823.6  -1372.2   2002.9      730 </span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="co">#&gt; Scaled residuals: </span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a><span class="co">#&gt; -258547      -1       0       0      66 </span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a><span class="co">#&gt; Lambda:</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="co">#&gt;         loading      SE</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="co">#&gt; lambda1  1.0000       .</span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a><span class="co">#&gt; lambda2  1.0000       .</span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a><span class="co">#&gt; lambda3 -0.1339 0.05121</span></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a><span class="co">#&gt;  Groups Name    Variance Std.Dev.</span></span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a><span class="co">#&gt;  id     loading 23.64    4.862   </span></span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a><span class="co">#&gt; Number of obs: 742, groups:  id, 333</span></span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a><span class="co">#&gt;               Estimate Std. Error  z value   Pr(&gt;|z|)</span></span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a><span class="co">#&gt; chd           -1.91520    0.27229 -7.03361  2.013e-12</span></span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a><span class="co">#&gt; fiber         17.94834    0.48686 36.86566 1.641e-297</span></span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a><span class="co">#&gt; fiber2         0.22406    0.41783  0.53624  5.918e-01</span></span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a><span class="co">#&gt; chd:age        0.06613    0.05931  1.11515  2.648e-01</span></span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a><span class="co">#&gt; chd:bus       -0.02900    0.34355 -0.08441  9.327e-01</span></span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a><span class="co">#&gt; fiber:age     -0.21207    0.10090 -2.10172  3.558e-02</span></span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a><span class="co">#&gt; fiber:bus     -1.68278    0.63721 -2.64084  8.270e-03</span></span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a><span class="co">#&gt; chd:age:bus   -0.04998    0.06507 -0.76812  4.424e-01</span></span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a><span class="co">#&gt; fiber:age:bus  0.16821    0.11223  1.49882  1.339e-01</span></span></code></pre></div>
<p>Now we were able to reproduce results very close to those in Table
14.1 on page 420 of <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>. This
is a useful assurance that the algorithm used by galamm is correctly
implemented.</p>
</div>
<div id="comparison-to-a-model-with-indirect-effect-only" class="section level3">
<h3>Comparison to a Model with Indirect Effect Only</h3>
<p>The model above assumed that the age and bus variables had both an
indirect effect on the risk of coronary heart disease through its impact
on fiber intake, as well as a direct effect. Still following <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>, we
now estimate an alternative model which only has indirect effects. The
disease model is now</p>
<p><span class="math display">\[
\text{logit}[P(y_{ij}=1 | \eta_{j})] = d_{ij3}\beta_{03} + \lambda
\eta_{j},
\]</span></p>
<p>The formula becomes</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>formula0 <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> chd <span class="sc">+</span> fiber <span class="sc">+</span> (age <span class="sc">*</span> bus)<span class="sc">:</span>fiber <span class="sc">+</span> fiber2 <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  (<span class="dv">0</span> <span class="sc">+</span> loading <span class="sc">|</span> id)</span></code></pre></div>
<p>Everything else is the same as before, so we fit the new model
with</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">galamm</span>(</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="at">formula =</span> formula0,</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  <span class="at">data =</span> diet,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  <span class="at">family =</span> families,</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="at">family_mapping =</span> family_mapping,</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  <span class="at">factor =</span> <span class="fu">list</span>(<span class="st">&quot;loading&quot;</span>),</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>  <span class="at">load.var =</span> <span class="st">&quot;item&quot;</span>,</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">list</span>(loading_matrix),</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="dv">10</span>),</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">galamm_control</span>(<span class="at">optim_control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="dv">3</span>))</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>)</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">#&gt; N = 8, M = 20 machine precision = 2.22045e-16</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="co">#&gt; At X0, 0 variables are exactly at the bounds</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="co">#&gt; At iterate     0  f=       2827.6  |proj g|=       123.31</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co">#&gt; At iterate    10  f =       1664.7  |proj g|=        25.235</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a><span class="co">#&gt; At iterate    20  f =       1427.9  |proj g|=        37.186</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a><span class="co">#&gt; At iterate    30  f =       1373.5  |proj g|=        5.1449</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a><span class="co">#&gt; iterations 37</span></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a><span class="co">#&gt; function evaluations 40</span></span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a><span class="co">#&gt; segments explored during Cauchy searches 38</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a><span class="co">#&gt; BFGS updates skipped 0</span></span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a><span class="co">#&gt; active bounds at final generalized Cauchy point 0</span></span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a><span class="co">#&gt; norm of the final projected gradient 0.000304544</span></span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a><span class="co">#&gt; final function value 1373.01</span></span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a><span class="co">#&gt; F = 1373.01</span></span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a><span class="co">#&gt; final  value 1373.013263 </span></span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a><span class="co">#&gt; converged</span></span></code></pre></div>
<p>Looking at the summary output, the estimates are now close to the
first column in Table 14.1 of <span class="citation">Skrondal and
Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">summary</span>(mod0)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt; Formula: formula0</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt;    Data: diet</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt; Control: galamm_control(optim_control = list(trace = 3))</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt;   2764.0   2805.5  -1373.0   2007.9      733 </span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">#&gt; Scaled residuals: </span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="co">#&gt; -280306      -1       0       0      66 </span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="co">#&gt; Lambda:</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="co">#&gt;         loading      SE</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a><span class="co">#&gt; lambda1   1.000       .</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="co">#&gt; lambda2   1.000       .</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="co">#&gt; lambda3  -0.136 0.05148</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="co">#&gt;  Groups Name    Variance Std.Dev.</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a><span class="co">#&gt;  id     loading 23.64    4.862   </span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a><span class="co">#&gt; Number of obs: 742, groups:  id, 333</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a><span class="co">#&gt;               Estimate Std. Error  z value   Pr(&gt;|z|)</span></span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a><span class="co">#&gt; chd            -1.9668    0.18248 -10.7783  4.360e-27</span></span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a><span class="co">#&gt; fiber          17.9741    0.48123  37.3504 2.502e-305</span></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a><span class="co">#&gt; fiber2          0.2238    0.41779   0.5358  5.921e-01</span></span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a><span class="co">#&gt; fiber:age      -0.1896    0.09914  -1.9122  5.585e-02</span></span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a><span class="co">#&gt; fiber:bus      -1.6991    0.62529  -2.7173  6.581e-03</span></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a><span class="co">#&gt; fiber:age:bus   0.1515    0.11012   1.3760  1.688e-01</span></span></code></pre></div>
<p>We can use <code>anova</code> method for galamm objects to compare
the models. AIC and BIC favor the simpler model with only indirect
effects.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">anova</span>(mod, mod0)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co">#&gt; Data: diet</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co">#&gt; Models:</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co">#&gt; mod0: formula0</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co">#&gt; mod: formula</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co">#&gt;      npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="co">#&gt; mod0    9 2764.0 2805.5 -1373.0   2002.9                     </span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co">#&gt; mod    12 2768.3 2823.6 -1372.2   2002.9 1.7058  3     0.6357</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-batesFittingLinearMixedEffects2015" class="csl-entry">
Bates, Douglas M, Martin Mächler, Ben Bolker, and Steve Walker. 2015.
<span>“Fitting <span>Linear Mixed-Effects Models Using</span>
Lme4.”</span> <em>Journal of Statistical Software</em> 67 (1): 1–48. <a href="https://doi.org/10.18637/jss.v067.i01">https://doi.org/10.18637/jss.v067.i01</a>.
</div>
<div id="ref-carrollMeasurementErrorNonlinear2006" class="csl-entry">
Carroll, Raymond J., David Ruppert, Leonard A. Stefanski, and Ciprian M.
Crainiceanu. 2006. <em>Measurement <span>Error</span> in <span>Nonlinear
Models</span>: <span>A Modern Perspective</span></em>. 2nd ed.
Monographs on <span>Statistics</span> and <span>Applied
Probability</span>. <span>Boca Raton, Florida</span>: <span>John Wiley
&amp; Sons</span>.
</div>
<div id="ref-morrisDietHeartPostscript1977" class="csl-entry">
Morris, J. N., J. W. Marr, and D. G. Clayton. 1977. <span>“Diet and
Heart: A Postscript.”</span> <em>Br Med J</em> 2 (6098): 1307–14. <a href="https://doi.org/10.1136/bmj.2.6098.1307">https://doi.org/10.1136/bmj.2.6098.1307</a>.
</div>
<div id="ref-rabe-heskethCorrectingCovariateMeasurement2003" class="csl-entry">
Rabe-Hesketh, Sophia, Andrew Pickles, and Anders Skrondal. 2003.
<span>“Correcting for Covariate Measurement Error in Logistic Regression
Using Nonparametric Maximum Likelihood Estimation.”</span>
<em>Statistical Modelling</em> 3 (3): 215–32. <a href="https://doi.org/10.1191/1471082X03st056oa">https://doi.org/10.1191/1471082X03st056oa</a>.
</div>
<div id="ref-rabe-heskethMaximumLikelihoodEstimation2003" class="csl-entry">
Rabe-Hesketh, Sophia, Anders Skrondal, and Andrew Pickles. 2003.
<span>“Maximum <span>Likelihood Estimation</span> of <span>Generalized
Linear Models</span> with <span>Covariate Measurement
Error</span>.”</span> <em>The Stata Journal</em> 3 (4): 386–411. <a href="https://doi.org/10.1177/1536867X0400300408">https://doi.org/10.1177/1536867X0400300408</a>.
</div>
<div id="ref-skrondalGeneralizedLatentVariable2004" class="csl-entry">
Skrondal, Anders, and Sophia Rabe-Hesketh. 2004. <em>Generalized Latent
Variable Modeling</em>. Interdisciplinary <span>Statistics
Series</span>. <span>Boca Raton, Florida</span>: <span>Chapman and
Hall/CRC</span>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
